<?php
/**
 * ç·Šæ€¥æŠ•ç¨¿ä½œæˆãƒ„ãƒ¼ãƒ«
 * URL: create-emergency-posts.php
 */

// WordPressã‚’èª­ã¿è¾¼ã¿
$wp_config_path = '../../../wp-config.php';
if (file_exists($wp_config_path)) {
    require_once($wp_config_path);
}

$message = '';
$success = false;

// æŠ•ç¨¿ä½œæˆå‡¦ç†
if (isset($_POST['create_posts'])) {
    global $wpdb;
    
    $created_posts = [];
    
    // 3ã¤ã®ç·Šæ€¥ãƒ†ã‚¹ãƒˆæŠ•ç¨¿ã‚’ä½œæˆ
    for ($i = 1; $i <= 3; $i++) {
        $post_data = array(
            'post_title' => "ç·Šæ€¥ãƒ†ã‚¹ãƒˆæŠ•ç¨¿ #$i",
            'post_content' => "<h2>ğŸ‰ æˆåŠŸï¼ç·Šæ€¥ãƒ†ã‚¹ãƒˆæŠ•ç¨¿ #$i ãŒæ­£ã—ãè¡¨ç¤ºã•ã‚Œã¦ã„ã¾ã™</h2>
                              <p><strong>æŠ•ç¨¿ç•ªå·:</strong> #$i</p>
                              <p><strong>ä½œæˆæ—¥æ™‚:</strong> " . date('Yå¹´mæœˆdæ—¥ H:i:s') . "</p>
                              <p><strong>ç›®çš„:</strong> æŠ•ç¨¿ID 229å›ºå®šå•é¡Œã®è§£æ±ºç¢ºèª</p>
                              <div style='background: #d4edda; padding: 15px; border-radius: 8px; margin: 20px 0;'>
                                  <h3 style='color: #155724; margin-top: 0;'>âœ… ã“ã®æŠ•ç¨¿ãŒè¡¨ç¤ºã•ã‚Œã¦ã„ã‚Œã°å•é¡Œè§£æ±ºæˆåŠŸã§ã™ï¼</h3>
                                  <p style='margin-bottom: 0;'>WordPressã®æŠ•ç¨¿è¡¨ç¤ºã‚·ã‚¹ãƒ†ãƒ ãŒæ­£å¸¸ã«å‹•ä½œã—ã¦ã„ã¾ã™ã€‚</p>
                              </div>",
            'post_status' => 'publish',
            'post_author' => 1,
            'post_date' => current_time('mysql'),
            'post_type' => 'post',
            'menu_order' => 0
        );
        
        // ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«ç›´æ¥æŒ¿å…¥
        $result = $wpdb->insert($wpdb->posts, $post_data);
        
        if ($result) {
            $new_post_id = $wpdb->insert_id;
            
            // ã‚«ã‚¹ã‚¿ãƒ ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚‚è¿½åŠ 
            $wpdb->insert($wpdb->postmeta, array(
                'post_id' => $new_post_id,
                'meta_key' => 'menu_no',
                'meta_value' => "TEST-$i-00-00"
            ));
            
            $created_posts[] = array(
                'id' => $new_post_id,
                'title' => "ç·Šæ€¥ãƒ†ã‚¹ãƒˆæŠ•ç¨¿ #$i"
            );
        }
    }
    
    if (!empty($created_posts)) {
        $success = true;
        $message = "âœ… " . count($created_posts) . "ä»¶ã®ç·Šæ€¥ãƒ†ã‚¹ãƒˆæŠ•ç¨¿ã‚’ä½œæˆã—ã¾ã—ãŸï¼";
    } else {
        $message = "âŒ æŠ•ç¨¿ã®ä½œæˆã«å¤±æ•—ã—ã¾ã—ãŸã€‚";
    }
}

?>
<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸš¨ ç·Šæ€¥æŠ•ç¨¿ä½œæˆãƒ„ãƒ¼ãƒ«</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 0; padding: 20px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; min-height: 100vh; }
        .container { max-width: 800px; margin: 0 auto; background: rgba(0,0,0,0.8); padding: 40px; border-radius: 15px; }
        .emergency { background: #dc3545; padding: 25px; border-radius: 10px; text-align: center; margin: 20px 0; animation: pulse 2s infinite; }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.05); } 100% { transform: scale(1); } }
        .create-button { background: #28a745; color: white; padding: 20px 40px; border: none; border-radius: 10px; font-size: 1.3em; font-weight: bold; cursor: pointer; margin: 20px 10px; }
        .create-button:hover { background: #218838; transform: translateY(-2px); }
        .test-link { background: #007bff; color: white; padding: 12px 20px; text-decoration: none; border-radius: 6px; margin: 8px; font-weight: bold; display: inline-block; }
        .success-box { background: #28a745; padding: 20px; border-radius: 10px; margin: 20px 0; }
        .error-box { background: #dc3545; padding: 20px; border-radius: 10px; margin: 20px 0; }
    </style>
</head>
<body>
    <div class="container">
        <div class="emergency">
            <h1 style="margin: 0; font-size: 2.5em;">ğŸš¨ ç·Šæ€¥æŠ•ç¨¿ä½œæˆãƒ„ãƒ¼ãƒ«</h1>
            <p style="margin: 10px 0; font-size: 1.2em;">æŠ•ç¨¿ID 229å›ºå®šå•é¡Œè§£æ±ºã®ãŸã‚</p>
        </div>

        <?php if ($message): ?>
            <div class="<?php echo $success ? 'success-box' : 'error-box'; ?>">
                <h2><?php echo htmlspecialchars($message); ?></h2>
            </div>
        <?php endif; ?>

        <?php if ($success && !empty($created_posts)): ?>
            <div class="success-box">
                <h2>ğŸ¯ ä½œæˆã•ã‚ŒãŸæŠ•ç¨¿ã§ãƒ†ã‚¹ãƒˆ</h2>
                <p>ä»¥ä¸‹ã®ãƒªãƒ³ã‚¯ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ã€æŠ•ç¨¿ID 229ä»¥å¤–ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã‹ãƒ†ã‚¹ãƒˆã—ã¦ãã ã•ã„ï¼š</p>
                
                <?php foreach ($created_posts as $post): ?>
                <div style="background: rgba(255,255,255,0.1); padding: 15px; border-radius: 8px; margin: 10px 0;">
                    <h3><?php echo htmlspecialchars($post['title']); ?> (ID: <?php echo $post['id']; ?>)</h3>
                    <div>
                        <a href="?p=<?php echo $post['id']; ?>" class="test-link">?p=<?php echo $post['id']; ?></a>
                        <a href="?page_id=<?php echo $post['id']; ?>" class="test-link">?page_id=<?php echo $post['id']; ?></a>
                        <a href="show-post.php?id=<?php echo $post['id']; ?>" target="_blank" class="test-link">å°‚ç”¨ã‚·ã‚¹ãƒ†ãƒ </a>
                    </div>
                </div>
                <?php endforeach; ?>
            </div>
        <?php else: ?>
            <div style="background: rgba(255,255,255,0.1); padding: 30px; border-radius: 10px; text-align: center;">
                <h2>ğŸ“ ç·Šæ€¥ãƒ†ã‚¹ãƒˆæŠ•ç¨¿ã‚’ä½œæˆ</h2>
                <p style="font-size: 1.1em;">æŠ•ç¨¿ID 229å•é¡Œã‚’è§£æ±ºã™ã‚‹ãŸã‚ã€æ–°ã—ã„ãƒ†ã‚¹ãƒˆæŠ•ç¨¿ã‚’3ä»¶ä½œæˆã—ã¾ã™ã€‚</p>
                
                <form method="post" style="margin: 30px 0;">
                    <button type="submit" name="create_posts" class="create-button">
                        ğŸš€ ç·Šæ€¥ãƒ†ã‚¹ãƒˆæŠ•ç¨¿ã‚’ä½œæˆã™ã‚‹
                    </button>
                </form>
                
                <p style="font-size: 0.9em; color: #ccc;">â€» ä½œæˆå¾Œã€å„æŠ•ç¨¿ã®ãƒªãƒ³ã‚¯ã‚’ãƒ†ã‚¹ãƒˆã—ã¦å•é¡ŒãŒè§£æ±ºã•ã‚ŒãŸã‹ç¢ºèªã§ãã¾ã™</p>
            </div>
        <?php endif; ?>

        <div style="text-align: center; margin-top: 40px;">
            <a href="javascript:history.back()" style="background: #6c757d; color: white; padding: 15px 25px; text-decoration: none; border-radius: 8px;">â† æˆ»ã‚‹</a>
        </div>
    </div>
</body>
</html>